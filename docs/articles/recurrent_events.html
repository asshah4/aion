<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="aion">
<title>Recurrent Event Analysis • aion</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Recurrent Event Analysis">
<meta property="og:description" content="aion">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">aion</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="external-link nav-link" href="https://asshah4.github.io/">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/recurrent_events.html">Recurrent Event Analysis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/asshah4/aion/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Recurrent Event Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/asshah4/aion/blob/HEAD/vignettes/recurrent_events.Rmd" class="external-link"><code>vignettes/recurrent_events.Rmd</code></a></small>
      <div class="d-none name"><code>recurrent_events.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/asshah4/aion" class="external-link">aion</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=card" class="external-link">card</a></span><span class="op">)</span></span></code></pre></div>
<p>Recurrent events are an extension of general survival models. These
functions are mostly well captured within the <a href="https://github.com/therneau/survival" class="external-link">survival</a>
package, except for the data preparation. This will walk through the
approach in <code>R</code> using using a sample data set from the
<a href="https://cran.r-project.org/package=card" class="external-link">card</a> package.</p>
<p>First we will set up the data. There are several events, and several
event types, including a final censoring event. This is in a relatively
standard data format, with each row fully describing each subject and
the corresponding events.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"stress"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stress</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 11</span></span></span>
<span><span class="co">#&gt;      id start      stop       head_ache_date_1 head_ache…¹ head_ach…² heart_ac…³</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   123 2014-08-26 2016-12-08 2016-12-08       <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>   117 2014-08-12 2016-10-30 2016-10-30       <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>   145 2014-10-22 2016-07-31 2016-06-01       2016-07-31  <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>   144 2014-10-21 2017-03-24 2015-02-12       <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>         2017-02-18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>   204 2015-03-16 2015-04-03 <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>   283 2015-10-12 2016-01-19 <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 4 more variables: heart_ache_date_2 &lt;date&gt;, heart_ache_date_3 &lt;date&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   death &lt;dbl&gt;, broken_heart &lt;dbl&gt;, and abbreviated variable names</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ¹​head_ache_date_2, ²​head_ache_date_3, ³​heart_ache_date_1</span></span></span>
<span></span>
<span><span class="co"># For short cuts</span></span>
<span><span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"head_ache_date_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"heart_ache_date_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="traditional-model">Traditional model<a class="anchor" aria-label="anchor" href="#traditional-model"></a>
</h2>
<p>This is a traditional survival analysis. It requires almost no
formating, but is available for thoroughness.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trad_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/recur.html">recur</a></span><span class="op">(</span></span>
<span>    <span class="va">stress</span>,</span>
<span>    model_type <span class="op">=</span> <span class="st">"trad"</span>,</span>
<span>    id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>    left <span class="op">=</span> <span class="st">"start"</span>,</span>
<span>    right <span class="op">=</span> <span class="st">"stop"</span>,</span>
<span>    censor <span class="op">=</span> <span class="st">"death"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trad_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;      id status start  stop strata   date       events</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1      0     0  <span style="text-decoration: underline;">1</span>914 strata_0 2017-10-23      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2      0     0  <span style="text-decoration: underline;">1</span>797 strata_0 2017-07-17      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3      0     0     2 strata_0 2012-08-29      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4      0     0  <span style="text-decoration: underline;">1</span>776 strata_0 2017-07-10      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5      0     0  <span style="text-decoration: underline;">1</span>780 strata_0 2017-07-20      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6      0     0  <span style="text-decoration: underline;">1</span>753 strata_0 2017-07-10      0</span></span>
<span></span>
<span><span class="co"># Now add back a covariate for analysis</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">trad_data</span>, <span class="va">stress</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"broken_heart"</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"id"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">stop</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">broken_heart</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(stop, status) ~ broken_heart, data = df)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   n= 98, number of events= 6 </span></span>
<span><span class="co">#&gt;    (2 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 coef exp(coef) se(coef)      z Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; broken_heart -0.1294    0.8786   0.8166 -0.158    0.874</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;              exp(coef) exp(-coef) lower .95 upper .95</span></span>
<span><span class="co">#&gt; broken_heart    0.8786      1.138    0.1773     4.354</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Concordance= 0.508  (se = 0.102 )</span></span>
<span><span class="co">#&gt; Likelihood ratio test= 0.03  on 1 df,   p=0.9</span></span>
<span><span class="co">#&gt; Wald test            = 0.03  on 1 df,   p=0.9</span></span>
<span><span class="co">#&gt; Score (logrank) test = 0.03  on 1 df,   p=0.9</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="andersen-gill-model">Andersen-Gill model<a class="anchor" aria-label="anchor" href="#andersen-gill-model"></a>
</h2>
<p>The Andersen-Gill model is a generalization of the Cox model. There
is a common baseline hazard for all events, and assumes constant hazard
throughout time. It highlights the estimate on the intensity of the
reucrrent events.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ag_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/recur.html">recur</a></span><span class="op">(</span></span>
<span>    <span class="va">stress</span>,</span>
<span>    model_type <span class="op">=</span> <span class="st">"ag"</span>,</span>
<span>    id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>    left <span class="op">=</span> <span class="st">"start"</span>,</span>
<span>    right <span class="op">=</span> <span class="st">"stop"</span>,</span>
<span>    censor <span class="op">=</span> <span class="st">"death"</span>,</span>
<span>    event_dates <span class="op">=</span> <span class="va">events</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ag_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;      id status start  stop strata   date       events</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1      0     0  <span style="text-decoration: underline;">1</span>914 strata_0 2017-10-23      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2      0     0  <span style="text-decoration: underline;">1</span>797 strata_0 2017-07-17      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3      0     0     2 strata_0 2012-08-29      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4      0     0  <span style="text-decoration: underline;">1</span>776 strata_0 2017-07-10      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5      0     0  <span style="text-decoration: underline;">1</span>780 strata_0 2017-07-20      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6      0     0  <span style="text-decoration: underline;">1</span>753 strata_0 2017-07-10      0</span></span></code></pre></div>
<p>As you can see, the number of rows has increased, as there are
multiple events now for each subject. Of note, the events are given
equal weight.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now add back a covariate for analysis</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">ag_data</span>, <span class="va">stress</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"broken_heart"</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"id"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">stop</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">broken_heart</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"breslow"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">df</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in Surv(start, stop, status): Stop time must be &gt; start time, NA created</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(start, stop, status) ~ broken_heart, data = df, </span></span>
<span><span class="co">#&gt;     method = "breslow")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   n= 173, number of events= 87 </span></span>
<span><span class="co">#&gt;    (18 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 coef exp(coef) se(coef)      z Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; broken_heart -1.0597    0.3466   0.2370 -4.471 7.77e-06 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;              exp(coef) exp(-coef) lower .95 upper .95</span></span>
<span><span class="co">#&gt; broken_heart    0.3466      2.885    0.2178    0.5515</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Concordance= 0.632  (se = 0.028 )</span></span>
<span><span class="co">#&gt; Likelihood ratio test= 22.33  on 1 df,   p=2e-06</span></span>
<span><span class="co">#&gt; Wald test            = 19.99  on 1 df,   p=8e-06</span></span>
<span><span class="co">#&gt; Score (logrank) test = 21.93  on 1 df,   p=3e-06</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="wei-lin-weissfield-or-marginal-model">Wei-Lin-Weissfield or marginal model<a class="anchor" aria-label="anchor" href="#wei-lin-weissfield-or-marginal-model"></a>
</h2>
<p>This model does not specifiy dependence structures amongst recurrent
event times within a subject. There is also not a baseline hazard
assumption. However, the max number of events are specified in advance.
We tend to use this when the dependence structure is complex or unknown
(and may not matter).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marg_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/recur.html">recur</a></span><span class="op">(</span></span>
<span>    <span class="va">stress</span>,</span>
<span>    model_type <span class="op">=</span> <span class="st">"marginal"</span>,</span>
<span>    id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>    left <span class="op">=</span> <span class="st">"start"</span>,</span>
<span>    right <span class="op">=</span> <span class="st">"stop"</span>,</span>
<span>    censor <span class="op">=</span> <span class="st">"death"</span>,</span>
<span>    event_dates <span class="op">=</span> <span class="va">events</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">marg_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;      id status start  stop strata   date       events</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1      0     0  <span style="text-decoration: underline;">1</span>914 strata_0 2017-10-23      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2      0     0  <span style="text-decoration: underline;">1</span>797 strata_0 2017-07-17      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3      0     0     2 strata_0 2012-08-29      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4      0     0  <span style="text-decoration: underline;">1</span>776 strata_0 2017-07-10      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5      0     0  <span style="text-decoration: underline;">1</span>780 strata_0 2017-07-20      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6      0     0  <span style="text-decoration: underline;">1</span>753 strata_0 2017-07-10      0</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">marg_data</span><span class="op">$</span><span class="va">strata</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "strata_0" "strata_1" "strata_2" "strata_3" "strata_4" "strata_5"</span></span></code></pre></div>
<p>There are strata now for recurring events.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now add back a covariate for analysis</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">marg_data</span>, <span class="va">stress</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"broken_heart"</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"id"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">stop</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">broken_heart</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,</span>
<span>  robust <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"breslow"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">df</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in Surv(start, stop, status): Stop time must be &gt; start time, NA created</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(start, stop, status) ~ broken_heart, data = df, </span></span>
<span><span class="co">#&gt;     robust = TRUE, method = "breslow", cluster = id)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   n= 180, number of events= 90 </span></span>
<span><span class="co">#&gt;    (11 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 coef exp(coef) se(coef) robust se      z Pr(&gt;|z|)   </span></span>
<span><span class="co">#&gt; broken_heart -0.6795    0.5069   0.2306    0.2476 -2.744  0.00607 **</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;              exp(coef) exp(-coef) lower .95 upper .95</span></span>
<span><span class="co">#&gt; broken_heart    0.5069      1.973     0.312    0.8235</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Concordance= 0.572  (se = 0.03 )</span></span>
<span><span class="co">#&gt; Likelihood ratio test= 9.35  on 1 df,   p=0.002</span></span>
<span><span class="co">#&gt; Wald test            = 7.53  on 1 df,   p=0.006</span></span>
<span><span class="co">#&gt; Score (logrank) test = 9.02  on 1 df,   p=0.003,   Robust = 9.93  p=0.002</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   (Note: the likelihood ratio and score tests assume independence of</span></span>
<span><span class="co">#&gt;      observations within a cluster, the Wald and robust score tests do not).</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prentice-williams-peterson-pwp-model">Prentice, Williams, Peterson (PWP) model<a class="anchor" aria-label="anchor" href="#prentice-williams-peterson-pwp-model"></a>
</h2>
<p>The PWP orders events into strata, and counts all subjects at being
risk for the first event. But, it only includes risk for subjects that
have already had an event for subsequent strata. The two methods are to
use the total time or the time between events as the measure of
time.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">total_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/recur.html">recur</a></span><span class="op">(</span></span>
<span>    <span class="va">stress</span>,</span>
<span>    model_type <span class="op">=</span> <span class="st">"pwptt"</span>,</span>
<span>    id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>    left <span class="op">=</span> <span class="st">"start"</span>,</span>
<span>    right <span class="op">=</span> <span class="st">"stop"</span>,</span>
<span>    censor <span class="op">=</span> <span class="st">"death"</span>,</span>
<span>    event_dates <span class="op">=</span> <span class="va">events</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">total_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;      id status start  stop strata   date       events</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   283      1     0    99 strata_0 2016-01-19      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>   284      0     0   796 strata_0 2017-12-19      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>   287      1     0   131 strata_1 2016-02-27      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>   287      0   131   865 strata_0 2018-03-02      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>   311      0     0   728 strata_0 2018-01-23      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>   321      0     0   680 strata_0 2018-01-12      0</span></span>
<span></span>
<span><span class="va">gap_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/recur.html">recur</a></span><span class="op">(</span></span>
<span>    <span class="va">stress</span>,</span>
<span>    model_type <span class="op">=</span> <span class="st">"pwpgt"</span>,</span>
<span>    id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>    left <span class="op">=</span> <span class="st">"start"</span>,</span>
<span>    right <span class="op">=</span> <span class="st">"stop"</span>,</span>
<span>    censor <span class="op">=</span> <span class="st">"death"</span>,</span>
<span>    event_dates <span class="op">=</span> <span class="va">events</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">gap_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;      id status start  stop strata   date       events</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   283      1     0    99 strata_0 2016-01-19      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>   284      0     0   796 strata_0 2017-12-19      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>   287      1     0   131 strata_1 2016-02-27      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>   287      0     0   734 strata_0 2018-03-02      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>   311      0     0   728 strata_0 2018-01-23      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>   321      0     0   680 strata_0 2018-01-12      0</span></span></code></pre></div>
<p>The strata for events can effect the start time for risk for an event
in this model type. This show cases the findings with total time as part
of the risk.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now add back a covariate for analysis</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">total_data</span>, <span class="va">stress</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"broken_heart"</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"id"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">stop</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">broken_heart</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">strata</span><span class="op">)</span>,</span>
<span>  robust <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"breslow"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">df</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in Surv(start, stop, status): Stop time must be &gt; start time, NA created</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(start, stop, status) ~ broken_heart + strata(strata), </span></span>
<span><span class="co">#&gt;     data = df, robust = TRUE, method = "breslow", cluster = id)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   n= 173, number of events= 87 </span></span>
<span><span class="co">#&gt;    (18 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 coef exp(coef) se(coef) robust se      z Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; broken_heart -0.2337    0.7916   0.2705    0.2402 -0.973    0.331</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;              exp(coef) exp(-coef) lower .95 upper .95</span></span>
<span><span class="co">#&gt; broken_heart    0.7916      1.263    0.4943     1.268</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Concordance= 0.51  (se = 0.034 )</span></span>
<span><span class="co">#&gt; Likelihood ratio test= 0.77  on 1 df,   p=0.4</span></span>
<span><span class="co">#&gt; Wald test            = 0.95  on 1 df,   p=0.3</span></span>
<span><span class="co">#&gt; Score (logrank) test = 0.75  on 1 df,   p=0.4,   Robust = 0.87  p=0.4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   (Note: the likelihood ratio and score tests assume independence of</span></span>
<span><span class="co">#&gt;      observations within a cluster, the Wald and robust score tests do not).</span></span></code></pre></div>
<p>Here we use gap time.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now add back a covariate for analysis</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">gap_data</span>, <span class="va">stress</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"broken_heart"</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"id"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">stop</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">broken_heart</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">strata</span><span class="op">)</span>,</span>
<span>  robust <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"breslow"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">df</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in Surv(start, stop, status): Stop time must be &gt; start time, NA created</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(start, stop, status) ~ broken_heart + strata(strata), </span></span>
<span><span class="co">#&gt;     data = df, robust = TRUE, method = "breslow", cluster = id)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   n= 173, number of events= 87 </span></span>
<span><span class="co">#&gt;    (18 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 coef exp(coef) se(coef) robust se     z Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; broken_heart 0.01515   1.01526  0.25229   0.23920 0.063     0.95</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;              exp(coef) exp(-coef) lower .95 upper .95</span></span>
<span><span class="co">#&gt; broken_heart     1.015      0.985    0.6353     1.623</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Concordance= 0.501  (se = 0.035 )</span></span>
<span><span class="co">#&gt; Likelihood ratio test= 0  on 1 df,   p=1</span></span>
<span><span class="co">#&gt; Wald test            = 0  on 1 df,   p=0.9</span></span>
<span><span class="co">#&gt; Score (logrank) test = 0  on 1 df,   p=1,   Robust = 0  p=0.9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   (Note: the likelihood ratio and score tests assume independence of</span></span>
<span><span class="co">#&gt;      observations within a cluster, the Wald and robust score tests do not).</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="additional-methods">Additional methods<a class="anchor" aria-label="anchor" href="#additional-methods"></a>
</h2>
<ul>
<li>Multi-state models</li>
<li>Frailty models</li>
</ul>
<p>Will expand this in the future.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Anish Shah.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
